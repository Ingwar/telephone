{% extends "base.html" %}
{% load static %}
{% load crispy_forms_tags %}

{% block jumbotron %}

    <h1>Question</h1>

    {% if messages %}
    <ul class="messages list-group" style="list-style-type:none">
      {% for message in messages %}
      <li {% if message.tags %}class="alert alert-{{ message.tags }} alert-dismissible"{% endif %}>
        {{ message }}
        <button type="button" class="close" data-dismiss="alert"><span>&times;</span></button>
      </li>
      {% endfor %}
    </ul>
    {% endif %}

    <div id="id_target_audio" class="btn btn-default">
      <span class="glyphicon glyphicon-play"></span>
    </div>

    {% crispy form form.helper %}

{% endblock jumbotron %}

{% block javascript %}
  <script src="{% static 'd3/d3.min.js' %}" type="text/JavaScript"></script>
  <script src="{% static 'soundmanager2/script/soundmanager2.js' %}"></script>
  <script src="{% static 'ratings/survey.js' %}" type="text/JavaScript"></script>
  <script>
var question = {{ question.given.as_json | safe }},
    choices = {{ question.choices_as_json | safe }};

soundManager.setup({
  onready: function () {
    soundManager.createSound({
        id: "target",
        url: question.audio
    });

    var radios = d3.selectAll("label.radio-inline");
    radios
      .each(function (choice) {
        choice.soundObj = soundManager.createSound({
          id: choice.soundId,
          url: choice.audio
        });
      });
  }
})

$(function () {
  var target = d3.select("#id_target_audio");

  target
    .on("click", function () { soundManager.play("target"); });

  var radios = d3.selectAll("label.radio-inline");

  radios
    .data(choices);

  var play_message = function (choice) {
    choice.soundObj.play();
  }

  var pause_all = function () {
    soundManager.stopAll();
  }

  radios
    .on("mouseover", play_message)
    .on("mouseout", pause_all);
});

  </script>
{% endblock javascript %}
